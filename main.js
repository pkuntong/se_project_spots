!function(){"use strict";var e={d:function(t,o){for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r:function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{F8:function(){return n}});const o=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?((e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)})(t,o):(t.disabled=!1,t.classList.remove(o.inactiveButtonClass))},n=e=>{document.querySelectorAll(e.formSelector).forEach((t=>{((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);console.log(n),console.log(r),o(n,r,t),n.forEach((a=>{a.addEventListener("input",(function(){((e,t,o)=>{t.validity.valid?((e,t,o)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(o.inputErrorClass)})(e,t,o):((e,t,o,n)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),r.textContent=o})(e,t,t.validationMessage,o)})(e,a,t),o(n,r,t)}))}))})(t,e)}))};const r={editButton:document.querySelector(".profile__edit-button"),modal:document.querySelector("#edit-profile-modal"),closeButton:document.querySelector("#close-profile-modal"),form:document.querySelector("#edit-profile-form"),nameInput:document.querySelector("#edit-profile-input-name"),jobInput:document.querySelector("#edit-profile-input-description"),nameElement:document.querySelector(".profile__title"),jobElement:document.querySelector(".profile__description")},a={button:document.querySelector(".profile__add-button"),modal:document.querySelector("#new-post-modal"),closeButton:document.querySelector("#close-new-post-modal"),linkInput:document.querySelector("#new-post-image-link"),nameInput:document.querySelector("#new-post-input-description"),form:document.querySelector("#new-post-form")},l={template:document.querySelector("#card-template"),list:document.querySelector(".cards__list"),modal:document.querySelector("#preview-modal"),modalImage:document.querySelector(".modal__image"),modalCloseButton:document.querySelector(".modal__close-button"),modalCaption:document.querySelector(".modal__caption")};function s(e){e.classList.add("modal_opened"),document.addEventListener("keydown",d),e.addEventListener("click",i),e.addEventListener("click",u)}function c(e){e.classList.remove("modal_opened"),document.removeEventListener("keydown",d),e.removeEventListener("click",i),e.removeEventListener("click",u)}const d=e=>{if("Escape"===e.key){const e=document.querySelector(".modal_opened");e&&c(e)}},i=e=>{e.target.classList.contains("modal")&&c(e.currentTarget)},u=e=>{e.target.classList.contains("modal__close-button")&&c(e.currentTarget)};function m(e){const t=l.template.content.querySelector(".card").cloneNode(!0),o=t.querySelector(".card__title"),n=t.querySelector(".card__image"),r=t.querySelector(".card__like-button"),a=t.querySelector(".card__delete-button"),c=e._id;return o.textContent=e.name,n.src=e.link,n.alt=e.name,e.isLiked&&r.classList.add("card__like-button_liked"),r.addEventListener("click",(()=>{r.classList.contains("card__like-button_liked")?C.deleteLike(c).then((()=>{r.classList.remove("card__like-button_liked")})).catch((e=>console.error(`Error: ${e}`))):C.addLike(c).then((()=>{r.classList.add("card__like-button_liked")})).catch((e=>console.error(`Error: ${e}`)))})),a.addEventListener("click",(()=>{k=t,L=c,s(f)})),n.addEventListener("click",(()=>{l.modalCaption.textContent=e.name,l.modalImage.src=e.link,l.modalImage.alt=e.name,s(l.modal)})),t}r.editButton.addEventListener("click",(()=>{r.nameInput.value=r.nameElement.textContent,r.jobInput.value=r.jobElement.textContent,s(r.modal)})),r.closeButton.addEventListener("click",(()=>{c(r.modal)})),a.button.addEventListener("click",(()=>{s(a.modal)})),a.closeButton.addEventListener("click",(()=>{c(a.modal)})),r.form.addEventListener("submit",(function(e){e.preventDefault();const t=r.form.querySelector(".modal__submit-button"),o=t.textContent;t.textContent="Saving...",C.editUserInfo({name:r.nameInput.value,about:r.jobInput.value}).then((e=>{r.nameElement.textContent=e.name,r.jobElement.textContent=e.about,c(r.modal)})).catch((e=>console.error(`Error: ${e}`))).finally((()=>{t.textContent=o}))})),a.form.addEventListener("submit",(function(e){e.preventDefault();const t=a.form.querySelector(".modal__submit-button"),o=t.textContent;t.textContent="Saving...",C.addNewCard({name:a.nameInput.value,link:a.linkInput.value}).then((e=>{const t=m(e);l.list.prepend(t),a.form.reset(),c(a.modal)})).catch((e=>console.error(`Error: ${e}`))).finally((()=>{t.textContent=o}))})),l.modalCloseButton.addEventListener("click",(()=>{c(l.modal)}));const _=document.querySelector("#edit-avatar-modal"),p=_.querySelector(".modal__form"),h=document.querySelector(".profile__avatar-button"),y=(_.querySelector(".modal__submit-button"),_.querySelector(".modal__close-button")),v=_.querySelector("#edit-avatar-input-link"),b=document.querySelector(".profile__avatar");h.addEventListener("click",(()=>{s(_)})),y.addEventListener("click",(()=>{c(_)})),p.addEventListener("submit",(e=>{e.preventDefault();const t=p.querySelector(".modal__submit-button"),o=t.textContent;t.textContent="Saving...";const n=v.value;C.editAvatar(n).then((e=>{b.src=e.avatar,c(_)})).catch((e=>console.error(`Error: ${e}`))).finally((()=>{t.textContent=o}))}));const f=document.querySelector("#delete-modal"),S=document.querySelector("#delete-modal-form"),q=document.querySelector(".modal__cancel-button"),E=document.querySelector("#close-delete-modal");let k,L;S.addEventListener("submit",(e=>{e.preventDefault();const t=S.querySelector(".modal__submit-button"),o=t.textContent;t.textContent="Deleting...",C.deleteCard(L).then((()=>{k.remove(),c(f)})).catch((e=>console.error(`Error: ${e}`))).finally((()=>{t.textContent=o}))})),q.addEventListener("click",(()=>c(f))),E.addEventListener("click",(()=>c(f)));const C=new class{constructor(e){let{baseUrl:t,headers:o}=e;this._baseUrl=t,this._headers=o}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}checkResponse(e){return e.ok?e.json():Promise.reject(`Error ${e.status}`)}request(e,t){return fetch(e,t).then(this.checkResponse)}getInitialCards(){return this.request(`${this._baseUrl}/cards`,{headers:this._headers})}getUserInfo(){return this.request(`${this._baseUrl}/users/me`,{headers:this._headers})}editUserInfo(e){let{name:t,about:o}=e;return this.request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:o})})}editAvatarInfo(e){return this.request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}addCard(e){let{name:t,link:o}=e;return this.request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:o})})}deleteCard(e){return this.request(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}changeLikeStatus(e,t){return this.request(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}}({baseURL:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"85d7a969-7c91-4070-b3f0-78f45cb1eb48","Content-Type":"application/json"}});C.getAppInfo().then((e=>{let[t,o]=e;t.forEach((e=>{const t=m(e);l.list.append(t)})),r.nameElement.textContent=o.name,r.jobElement.textContent=o.about,b.src=o.avatar})).catch((e=>console.error(e))),n(t.validationConfig)}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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L3NlX3Byb2plY3Rfc3BvdHMvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy93ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCIvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBkZWZpbml0aW9uKSB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iaiwgcHJvcCkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7IH0iLCIvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG5fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG5cdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuXHR9XG5cdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG59OyIsImV4cG9ydCBjb25zdCBzZXR0aW5ncyA9IHtcbiAgICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gICAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9pbmFjdGl2ZVwiLFxuICAgIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAgIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yXCIsXG4gIH07XG4gIFxuICBjb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIH07XG4gIFxuICBjb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgfTtcbiAgXG4gIGNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgICBpbnB1dEVsZW1lbnQsXG4gICAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgICAgY29uZmlnXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICAgIH1cbiAgfTtcbiAgXG4gIGNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gICAgfSk7XG4gIH07XG4gIFxuICBleHBvcnQgY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9O1xuICBcbiAgY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB9XG4gIH07XG4gIFxuICBleHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xuICAgIH0pO1xuICB9O1xuICBcbiAgY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICAgIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICAgICk7XG4gICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgXG4gICAgY29uc29sZS5sb2coaW5wdXRMaXN0KTtcbiAgICBjb25zb2xlLmxvZyhidXR0b25FbGVtZW50KTtcbiAgXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuICBcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBcbiAgZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gICAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICAgIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfTtcbiAgIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHZhbGlkYXRpb25Db25maWcgfSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxuLy8gSW5pdGlhbCBDYXJkcyBEYXRhXG5jb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4gIC8vIEluaXRpYWwgY2FyZCBvYmplY3RzIGdvIGhlcmUuLi5cbl07XG5cbi8vIFByb2ZpbGUgRWxlbWVudHNcbmNvbnN0IHByb2ZpbGVFbGVtZW50cyA9IHtcbiAgZWRpdEJ1dHRvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKSxcbiAgbW9kYWw6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLW1vZGFsXCIpLFxuICBjbG9zZUJ1dHRvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjbG9zZS1wcm9maWxlLW1vZGFsXCIpLFxuICBmb3JtOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1mb3JtXCIpLFxuICBuYW1lSW5wdXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLWlucHV0LW5hbWVcIiksXG4gIGpvYklucHV0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1pbnB1dC1kZXNjcmlwdGlvblwiKSxcbiAgbmFtZUVsZW1lbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fdGl0bGVcIiksXG4gIGpvYkVsZW1lbnQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIiksXG59O1xuXG4vLyBOZXcgUG9zdCBFbGVtZW50c1xuY29uc3QgbmV3UG9zdEVsZW1lbnRzID0ge1xuICBidXR0b246IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ1dHRvblwiKSxcbiAgbW9kYWw6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIiksXG4gIGNsb3NlQnV0dG9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2Nsb3NlLW5ldy1wb3N0LW1vZGFsXCIpLFxuICBsaW5rSW5wdXQ6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtaW1hZ2UtbGlua1wiKSxcbiAgbmFtZUlucHV0OiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LWlucHV0LWRlc2NyaXB0aW9uXCIpLFxuICBmb3JtOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LWZvcm1cIiksXG59O1xuXG4vLyBDYXJkIEVsZW1lbnRzXG5jb25zdCBjYXJkRWxlbWVudHMgPSB7XG4gIHRlbXBsYXRlOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIiksXG4gIGxpc3Q6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIiksXG4gIG1vZGFsOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIiksXG4gIG1vZGFsSW1hZ2U6IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpLFxuICBtb2RhbENsb3NlQnV0dG9uOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idXR0b25cIiksXG4gIG1vZGFsQ2FwdGlvbjogZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKSxcbn07XG5cbi8vIFV0aWxpdHkgRnVuY3Rpb25zXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbE9uRXNjKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsb3NlTW9kYWxPbk92ZXJsYXlDbGljayk7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZU1vZGFsT25CdXR0b25DbGljayk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgY2xvc2VNb2RhbE9uRXNjKTtcbiAgbW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNsb3NlTW9kYWxPbk92ZXJsYXlDbGljayk7XG4gIG1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBjbG9zZU1vZGFsT25CdXR0b25DbGljayk7XG59XG5cbmNvbnN0IGNsb3NlTW9kYWxPbkVzYyA9IChldmVudCkgPT4ge1xuICBpZiAoZXZlbnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX29wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICB9XG59O1xuXG5jb25zdCBjbG9zZU1vZGFsT25PdmVybGF5Q2xpY2sgPSAoZXZlbnQpID0+IHtcbiAgaWYgKGV2ZW50LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtb2RhbFwiKSkge1xuICAgIGNsb3NlTW9kYWwoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gIH1cbn07XG5cbmNvbnN0IGNsb3NlTW9kYWxPbkJ1dHRvbkNsaWNrID0gKGV2ZW50KSA9PiB7XG4gIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibW9kYWxfX2Nsb3NlLWJ1dHRvblwiKSkge1xuICAgIGNsb3NlTW9kYWwoZXZlbnQuY3VycmVudFRhcmdldCk7XG4gIH1cbn07XG5cbi8vIEV2ZW50IExpc3RlbmVyc1xucHJvZmlsZUVsZW1lbnRzLmVkaXRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgcHJvZmlsZUVsZW1lbnRzLm5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVFbGVtZW50cy5uYW1lRWxlbWVudC50ZXh0Q29udGVudDtcbiAgcHJvZmlsZUVsZW1lbnRzLmpvYklucHV0LnZhbHVlID0gcHJvZmlsZUVsZW1lbnRzLmpvYkVsZW1lbnQudGV4dENvbnRlbnQ7XG4gIG9wZW5Nb2RhbChwcm9maWxlRWxlbWVudHMubW9kYWwpO1xufSk7XG5cbnByb2ZpbGVFbGVtZW50cy5jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjbG9zZU1vZGFsKHByb2ZpbGVFbGVtZW50cy5tb2RhbCk7XG59KTtcblxubmV3UG9zdEVsZW1lbnRzLmJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwobmV3UG9zdEVsZW1lbnRzLm1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0RWxlbWVudHMuY2xvc2VCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0RWxlbWVudHMubW9kYWwpO1xufSk7XG5cbnByb2ZpbGVFbGVtZW50cy5mb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xubmV3UG9zdEVsZW1lbnRzLmZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVOZXdQb3N0Rm9ybVN1Ym1pdCk7XG5cbmNhcmRFbGVtZW50cy5tb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoY2FyZEVsZW1lbnRzLm1vZGFsKTtcbn0pO1xuXG4vLyBGb3JtIFN1Ym1pc3Npb24gSGFuZGxlcnNcbmZ1bmN0aW9uIGhhbmRsZVByb2ZpbGVGb3JtU3VibWl0KGV2ZW50KSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgY29uc3Qgc3VibWl0QnV0dG9uID0gcHJvZmlsZUVsZW1lbnRzLmZvcm0ucXVlcnlTZWxlY3RvcihcbiAgICBcIi5tb2RhbF9fc3VibWl0LWJ1dHRvblwiXG4gICk7XG4gIGNvbnN0IG9yaWdpbmFsVGV4dCA9IHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcbiAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcblxuICBhcGlcbiAgICAuZWRpdFVzZXJJbmZvKHtcbiAgICAgIG5hbWU6IHByb2ZpbGVFbGVtZW50cy5uYW1lSW5wdXQudmFsdWUsXG4gICAgICBhYm91dDogcHJvZmlsZUVsZW1lbnRzLmpvYklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVFbGVtZW50cy5uYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVFbGVtZW50cy5qb2JFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwocHJvZmlsZUVsZW1lbnRzLm1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGBFcnJvcjogJHtlcnJ9YCkpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gb3JpZ2luYWxUZXh0O1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVOZXdQb3N0Rm9ybVN1Ym1pdChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IG5ld1Bvc3RFbGVtZW50cy5mb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gICAgXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIlxuICApO1xuICBjb25zdCBvcmlnaW5hbFRleHQgPSBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQ7XG4gIHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG5cbiAgYXBpXG4gICAgLmFkZE5ld0NhcmQoe1xuICAgICAgbmFtZTogbmV3UG9zdEVsZW1lbnRzLm5hbWVJbnB1dC52YWx1ZSxcbiAgICAgIGxpbms6IG5ld1Bvc3RFbGVtZW50cy5saW5rSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChkYXRhKTtcbiAgICAgIGNhcmRFbGVtZW50cy5saXN0LnByZXBlbmQoY2FyZEVsZW1lbnQpO1xuICAgICAgbmV3UG9zdEVsZW1lbnRzLmZvcm0ucmVzZXQoKTtcbiAgICAgIGNsb3NlTW9kYWwobmV3UG9zdEVsZW1lbnRzLm1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGBFcnJvcjogJHtlcnJ9YCkpXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gb3JpZ2luYWxUZXh0O1xuICAgIH0pO1xufVxuXG4vLyBDYXJkIENyZWF0aW9uIEZ1bmN0aW9uXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZEVsZW1lbnRzLnRlbXBsYXRlLmNvbnRlbnRcbiAgICAucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpXG4gICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZFRpdGxlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZEltYWdlID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnV0dG9uXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnV0dG9uXCIpO1xuXG4gIGNvbnN0IGNhcmRJRCA9IGRhdGEuX2lkO1xuICBjYXJkVGl0bGUudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7XG4gIGNhcmRJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZS5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgIGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ1dHRvbl9saWtlZFwiKTtcbiAgfVxuXG4gIGNhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgaXNMaWtlZCA9IGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5jb250YWlucyhcbiAgICAgIFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIlxuICAgICk7XG5cbiAgICBpZiAoaXNMaWtlZCkge1xuICAgICAgYXBpXG4gICAgICAgIC5kZWxldGVMaWtlKGNhcmRJRClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9saWtlZFwiKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoYEVycm9yOiAke2Vycn1gKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFwaVxuICAgICAgICAuYWRkTGlrZShjYXJkSUQpXG4gICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fbGlrZWRcIik7XG4gICAgICAgIH0pXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGBFcnJvcjogJHtlcnJ9YCkpO1xuICAgIH1cbiAgfSk7XG5cbiAgY2FyZERlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGN1cnJlbnRDYXJkRWxlbWVudCA9IGNhcmRFbGVtZW50O1xuICAgIGN1cnJlbnRDYXJkSUQgPSBjYXJkSUQ7XG4gICAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcbiAgfSk7XG5cbiAgY2FyZEltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY2FyZEVsZW1lbnRzLm1vZGFsQ2FwdGlvbi50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBjYXJkRWxlbWVudHMubW9kYWxJbWFnZS5zcmMgPSBkYXRhLmxpbms7XG4gICAgY2FyZEVsZW1lbnRzLm1vZGFsSW1hZ2UuYWx0ID0gZGF0YS5uYW1lO1xuICAgIG9wZW5Nb2RhbChjYXJkRWxlbWVudHMubW9kYWwpO1xuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbi8vIEVkaXQgQXZhdGFyIE1vZGFsXG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGF2YXRhclByb2ZpbGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1idXR0b25cIik7XG5jb25zdCBhdmF0YXJTdWJtaXRCdXR0b24gPSBhdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpO1xuY29uc3QgYXZhdGFyTW9kYWxDbG9zZUJ1dHRvbiA9IGF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idXR0b25cIlxuKTtcbmNvbnN0IGF2YXRhcklucHV0ID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1pbnB1dC1saW5rXCIpO1xuY29uc3QgcHJvZmlsZUF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5cbmF2YXRhclByb2ZpbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgb3Blbk1vZGFsKGF2YXRhck1vZGFsKTtcbn0pO1xuXG5hdmF0YXJNb2RhbENsb3NlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZlbnQpID0+IHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcblxuICBjb25zdCBzdWJtaXRCdXR0b24gPSBhdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idXR0b25cIik7XG4gIGNvbnN0IG9yaWdpbmFsVGV4dCA9IHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudDtcbiAgc3VibWl0QnV0dG9uLnRleHRDb250ZW50ID0gXCJTYXZpbmcuLi5cIjtcblxuICBjb25zdCBhdmF0YXJVcmwgPSBhdmF0YXJJbnB1dC52YWx1ZTtcblxuICBhcGlcbiAgICAuZWRpdEF2YXRhcihhdmF0YXJVcmwpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVBdmF0YXJJbWFnZS5zcmMgPSBkYXRhLmF2YXRhcjtcbiAgICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoYEVycm9yOiAke2Vycn1gKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQ7XG4gICAgfSk7XG59KTtcblxuLy8gRGVsZXRlIE1vZGFsXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlTW9kYWxGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWwtZm9ybVwiKTtcbmNvbnN0IGNhbmNlbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhbmNlbC1idXR0b25cIik7XG5jb25zdCBjbG9zZUJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2xvc2UtZGVsZXRlLW1vZGFsXCIpO1xuXG5sZXQgY3VycmVudENhcmRFbGVtZW50O1xubGV0IGN1cnJlbnRDYXJkSUQ7XG5cbmRlbGV0ZU1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldmVudCkgPT4ge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGRlbGV0ZU1vZGFsRm9ybS5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnV0dG9uXCIpO1xuICBjb25zdCBvcmlnaW5hbFRleHQgPSBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQ7XG4gIHN1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiRGVsZXRpbmcuLi5cIjtcblxuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChjdXJyZW50Q2FyZElEKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGN1cnJlbnRDYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICAgIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoYEVycm9yOiAke2Vycn1gKSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzdWJtaXRCdXR0b24udGV4dENvbnRlbnQgPSBvcmlnaW5hbFRleHQ7XG4gICAgfSk7XG59KTtcblxuY2FuY2VsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKGRlbGV0ZU1vZGFsKSk7XG5jbG9zZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChkZWxldGVNb2RhbCkpO1xuXG4vLyBBUEkgU2V0dXBcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVVJMOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjg1ZDdhOTY5LTdjOTEtNDA3MC1iM2YwLTc4ZjQ1Y2IxZWI0OFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmFwaVxuICAuZ2V0QXBwSW5mbygpXG4gIC50aGVuKChbY2FyZHMsIHVzZXJJbmZvXSkgPT4ge1xuICAgIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZCk7XG4gICAgICBjYXJkRWxlbWVudHMubGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuXG4gICAgcHJvZmlsZUVsZW1lbnRzLm5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gdXNlckluZm8ubmFtZTtcbiAgICBwcm9maWxlRWxlbWVudHMuam9iRWxlbWVudC50ZXh0Q29udGVudCA9IHVzZXJJbmZvLmFib3V0O1xuICAgIHByb2ZpbGVBdmF0YXJJbWFnZS5zcmMgPSB1c2VySW5mby5hdmF0YXI7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuXG4vLyBFbmFibGUgRm9ybSBWYWxpZGF0aW9uXG5lbmFibGVWYWxpZGF0aW9uKHZhbGlkYXRpb25Db25maWcpOyIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBjaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIHJlcXVlc3QodXJsLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIGZldGNoKHVybCwgb3B0aW9ucykudGhlbih0aGlzLmNoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsZW1lbnQiLCJjb25maWciLCJzb21lIiwiaW5wdXRFbGVtZW50IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImRpc2FibGVCdXR0b24iLCJkaXNhYmxlZCIsImNsYXNzTGlzdCIsImFkZCIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJyZW1vdmUiLCJlbmFibGVWYWxpZGF0aW9uIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9ybVNlbGVjdG9yIiwiZm9yRWFjaCIsImZvcm1FbGVtZW50Iiwic2V0RXZlbnRMaXN0ZW5lcnMiLCJBcnJheSIsImZyb20iLCJpbnB1dFNlbGVjdG9yIiwicXVlcnlTZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiY29uc29sZSIsImxvZyIsImFkZEV2ZW50TGlzdGVuZXIiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJoaWRlSW5wdXRFcnJvciIsImlkIiwidGV4dENvbnRlbnQiLCJpbnB1dEVycm9yQ2xhc3MiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsImVycm9yRWxlbWVudCIsInZhbGlkYXRpb25NZXNzYWdlIiwicHJvZmlsZUVsZW1lbnRzIiwiZWRpdEJ1dHRvbiIsIm1vZGFsIiwiY2xvc2VCdXR0b24iLCJmb3JtIiwibmFtZUlucHV0Iiwiam9iSW5wdXQiLCJuYW1lRWxlbWVudCIsImpvYkVsZW1lbnQiLCJuZXdQb3N0RWxlbWVudHMiLCJidXR0b24iLCJsaW5rSW5wdXQiLCJjYXJkRWxlbWVudHMiLCJ0ZW1wbGF0ZSIsImxpc3QiLCJtb2RhbEltYWdlIiwibW9kYWxDbG9zZUJ1dHRvbiIsIm1vZGFsQ2FwdGlvbiIsIm9wZW5Nb2RhbCIsImNsb3NlTW9kYWxPbkVzYyIsImNsb3NlTW9kYWxPbk92ZXJsYXlDbGljayIsImNsb3NlTW9kYWxPbkJ1dHRvbkNsaWNrIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldmVudCIsIm9wZW5lZE1vZGFsIiwidGFyZ2V0IiwiY29udGFpbnMiLCJjdXJyZW50VGFyZ2V0IiwiZ2V0Q2FyZEVsZW1lbnQiLCJkYXRhIiwiY2FyZEVsZW1lbnQiLCJjb250ZW50IiwiY2xvbmVOb2RlIiwiY2FyZFRpdGxlIiwiY2FyZEltYWdlIiwiY2FyZExpa2VCdXR0b24iLCJjYXJkRGVsZXRlQnV0dG9uIiwiY2FyZElEIiwiX2lkIiwibmFtZSIsInNyYyIsImxpbmsiLCJhbHQiLCJpc0xpa2VkIiwiYXBpIiwiZGVsZXRlTGlrZSIsInRoZW4iLCJjYXRjaCIsImVyciIsImVycm9yIiwiYWRkTGlrZSIsImN1cnJlbnRDYXJkRWxlbWVudCIsImN1cnJlbnRDYXJkSUQiLCJkZWxldGVNb2RhbCIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnV0dG9uIiwib3JpZ2luYWxUZXh0IiwiZWRpdFVzZXJJbmZvIiwiYWJvdXQiLCJmaW5hbGx5IiwiYWRkTmV3Q2FyZCIsInByZXBlbmQiLCJyZXNldCIsImF2YXRhck1vZGFsIiwiYXZhdGFyRm9ybSIsImF2YXRhclByb2ZpbGVCdXR0b24iLCJhdmF0YXJNb2RhbENsb3NlQnV0dG9uIiwiYXZhdGFySW5wdXQiLCJwcm9maWxlQXZhdGFySW1hZ2UiLCJhdmF0YXJVcmwiLCJlZGl0QXZhdGFyIiwiYXZhdGFyIiwiZGVsZXRlTW9kYWxGb3JtIiwiY2FuY2VsQnV0dG9uIiwiZGVsZXRlQ2FyZCIsImNvbnN0cnVjdG9yIiwiX3JlZiIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9iYXNlVXJsIiwiX2hlYWRlcnMiLCJnZXRBcHBJbmZvIiwiUHJvbWlzZSIsImFsbCIsImdldEluaXRpYWxDYXJkcyIsImdldFVzZXJJbmZvIiwiY2hlY2tSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsInJlamVjdCIsInN0YXR1cyIsInJlcXVlc3QiLCJ1cmwiLCJvcHRpb25zIiwiZmV0Y2giLCJfcmVmMiIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdEF2YXRhckluZm8iLCJhZGRDYXJkIiwiX3JlZjMiLCJjaGFuZ2VMaWtlU3RhdHVzIiwiYmFzZVVSTCIsImF1dGhvcml6YXRpb24iLCJjYXJkcyIsInVzZXJJbmZvIiwiY2FyZCIsImFwcGVuZCIsInZhbGlkYXRpb25Db25maWciXSwic291cmNlUm9vdCI6IiJ9