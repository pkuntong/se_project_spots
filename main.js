!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?((e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)})(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},r=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}checkResponse(e){return e.ok?e.json():Promise.reject(`Error ${e.status}`)}request(e,t){return fetch(e,t).then(this.checkResponse)}getInitialCards(){return this.request(`${this._baseUrl}/cards`,{headers:this._headers})}getUserInfo(){return this.request(`${this._baseUrl}/users/me`,{headers:this._headers})}editUserInfo(e){let{name:t,about:r}=e;return this.request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}editAvatarInfo(e){return this.request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}addCard(e){let{name:t,link:r}=e;return this.request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}deleteCard(e){return this.request(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}changeLikeStatus(e,t){return this.request(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"8821c207-7c9b-4450-ae25-85456081faad","Content-Type":"application/json"}});function s(e){e.target===e.currentTarget&&a(e.currentTarget)}function o(e){"Escape"===e.key&&a(document.querySelector(".modal_opened"))}function a(e){e&&(e.classList.remove("modal_opened"),document.removeEventListener("keydown",o),e.removeEventListener("mousedown",s))}function n(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend";const r=function(e){if(!cardTemplate)return console.error("Error: cardTemplate is not defined or not found."),null;const t=cardTemplate.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),s=t.querySelector(".card__image"),o=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return r.textContent=e.name,s.src=e.link,s.alt=e.name,e.isLiked&&o.classList.add("card__like-btn_liked"),o.addEventListener("click",(t=>handleLike(t,e._id))),a.addEventListener("click",(()=>handleDeleteCard(t,e._id))),s.addEventListener("click",(()=>handleImageClick(e))),t}(e);r&&cardsList[t](r)}document.addEventListener("DOMContentLoaded",(()=>{const s=document.querySelectorAll(".modal__close-btn"),o=document.querySelector("#card-template")?.content,i=document.querySelector(".cards__list");var l;console.log("Card template:",o),o?(r.getAppInfo().then((e=>{let[t,r]=e;console.log("Fetched cards:",t),0===t.length?(console.log("No cards available"),i.innerHTML="<p>No cards to display.</p>"):(t.reverse(),t.forEach((e=>{n(e)}))),profileImage.src=r.avatar,profileName.textContent=r.name,profileDescription.textContent=r.about})).catch(console.error),s.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>a(t)))})),l=e,document.querySelectorAll(l.formSelector).forEach((e=>{((e,r)=>{const s=Array.from(e.querySelectorAll(r.inputSelector)),o=e.querySelector(r.submitButtonSelector);console.log(s),console.log(o),t(s,o,r),s.forEach((a=>{a.addEventListener("input",(function(){((e,t,r)=>{t.validity.valid?((e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)})(e,t,r):((e,t,r,s)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add(s.inputErrorClass),o.textContent=r})(e,t,t.validationMessage,r)})(e,a,r),t(s,o,r)}))}))})(e,l)}))):console.error("Error: Card template not found.")}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEVBQWErQyxZQUNoRS9DLEVBQWFNLFVBQVVDLElBQUlULEVBQU9MLGlCQUNsQ3NILEVBQWFsQyxZQUFjaUMsQ0FBWSxFQVdyQ0QsQ0FDRU4sRUFDQXZHLEVBQ0FBLEVBQWFnSCxrQkFDYmxILEVBSUosRUEwQ0k2RyxDQUFtQkosRUFBYXZHLEVBQWNGLEdBQzlDSCxFQUFrQkMsRUFBV0MsRUFBZUMsRUFDOUMsR0FBRSxHQUNGLEVBTUEwRyxDQUFrQkQsRUFBYXpHLEVBQU8sS0NleEN3RSxRQUFRQyxNQUFNLGtDQWtDVSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qgc2V0dGluZ3MgPSB7XG4gICAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICAgIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5faW5hY3RpdmVcIixcbiAgICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgICBlcnJvckNsYXNzOiBcIm1vZGFsX19lcnJvclwiLFxuICB9O1xuICBcbiAgY29uc3Qgc2hvd0lucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgZXJyb3JNZXNzYWdlLCBjb25maWcpID0+IHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICB9O1xuICBcbiAgY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbGVtZW50LmlkfS1lcnJvcmApO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgaW5wdXRFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gIH07XG4gIFxuICBjb25zdCBjaGVja0lucHV0VmFsaWRpdHkgPSAoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKSA9PiB7XG4gICAgaWYgKCFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQpIHtcbiAgICAgIHNob3dJbnB1dEVycm9yKFxuICAgICAgICBmb3JtRWxlbWVudCxcbiAgICAgICAgaW5wdXRFbGVtZW50LFxuICAgICAgICBpbnB1dEVsZW1lbnQudmFsaWRhdGlvbk1lc3NhZ2UsXG4gICAgICAgIGNvbmZpZ1xuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0RWxlbWVudCwgY29uZmlnKTtcbiAgICB9XG4gIH07XG4gIFxuICBjb25zdCBoYXNJbnZhbGlkSW5wdXQgPSAoaW5wdXRMaXN0KSA9PiB7XG4gICAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsZW1lbnQpID0+IHtcbiAgICAgIHJldHVybiAhaW5wdXRFbGVtZW50LnZhbGlkaXR5LnZhbGlkO1xuICAgIH0pO1xuICB9O1xuICBcbiAgZXhwb3J0IGNvbnN0IGRpc2FibGVCdXR0b24gPSAoYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IHRydWU7XG4gICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgfTtcbiAgXG4gIGNvbnN0IHRvZ2dsZUJ1dHRvblN0YXRlID0gKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKSA9PiB7XG4gICAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpKSB7XG4gICAgICBkaXNhYmxlQnV0dG9uKGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgIGJ1dHRvbkVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgfVxuICB9O1xuICBcbiAgZXhwb3J0IGNvbnN0IHJlc2V0VmFsaWRhdGlvbiA9IChmb3JtRWxlbWVudCwgaW5wdXRMaXN0LCBjb25maWcpID0+IHtcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXQpID0+IHtcbiAgICAgIGhpZGVJbnB1dEVycm9yKGZvcm1FbGVtZW50LCBpbnB1dCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfTtcbiAgXG4gIGNvbnN0IHNldEV2ZW50TGlzdGVuZXJzID0gKGZvcm1FbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKFxuICAgICAgZm9ybUVsZW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcilcbiAgICApO1xuICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gIFxuICAgIGNvbnNvbGUubG9nKGlucHV0TGlzdCk7XG4gICAgY29uc29sZS5sb2coYnV0dG9uRWxlbWVudCk7XG4gIFxuICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgXG4gICAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgaW5wdXRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICAgICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbiAgXG4gIGV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICAgIGNvbnN0IGZvcm1MaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKTtcbiAgICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWxlbWVudCkgPT4ge1xuICAgICAgc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsZW1lbnQsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH07XG4gICIsImltcG9ydCBcIi4vaW5kZXguY3NzXCI7XG5pbXBvcnQge1xuICBlbmFibGVWYWxpZGF0aW9uLFxuICBzZXR0aW5ncyxcbiAgcmVzZXRWYWxpZGF0aW9uLFxuICBkaXNhYmxlQnV0dG9uLFxufSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgeyBoYW5kbGVTdWJtaXQgfSBmcm9tIFwiLi4vdXRpbHMvaGVscGVyc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5cbmxldCBzZWxlY3RlZENhcmQsIHNlbGVjdGVkQ2FyZElkO1xuXG4vLyBBUEkgc2V0dXBcbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjg4MjFjMjA3LTdjOWItNDQ1MC1hZTI1LTg1NDU2MDgxZmFhZFwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbi8vIEZ1bmN0aW9ucyB0byBoYW5kbGUgbW9kYWxzXG5mdW5jdGlvbiBjbG9zZU1vZGFsT3ZlcmxheShldnQpIHtcbiAgaWYgKGV2dC50YXJnZXQgPT09IGV2dC5jdXJyZW50VGFyZ2V0KSB7XG4gICAgY2xvc2VNb2RhbChldnQuY3VycmVudFRhcmdldCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbEVzYyhldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBtb2RhbE9wZW5lZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfb3BlbmVkXCIpO1xuICAgIGNsb3NlTW9kYWwobW9kYWxPcGVuZWQpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG9wZW5Nb2RhbChtb2RhbCkge1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU1vZGFsRXNjKTtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBjbG9zZU1vZGFsT3ZlcmxheSk7XG59XG5cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgaWYgKG1vZGFsKSB7XG4gICAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX29wZW5lZFwiKTtcbiAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBjbG9zZU1vZGFsRXNjKTtcbiAgICBtb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGNsb3NlTW9kYWxPdmVybGF5KTtcbiAgfVxufVxuXG4vLyBGdW5jdGlvbiB0byByZW5kZXIgYSBjYXJkXG5mdW5jdGlvbiByZW5kZXJDYXJkKGl0ZW0sIG1ldGhvZCA9IFwicHJlcGVuZFwiKSB7XG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoaXRlbSk7XG4gIGlmIChjYXJkRWxlbWVudCkge1xuICAgIGNhcmRzTGlzdFttZXRob2RdKGNhcmRFbGVtZW50KTsgLy8gQXBwZW5kIHRoZSBjYXJkIHRvIHRoZSBjYXJkcyBsaXN0XG4gIH1cbn1cblxuLy8gQ3JlYXRlIGEgY2FyZCBlbGVtZW50IGZyb20gdGhlIHRlbXBsYXRlXG5mdW5jdGlvbiBnZXRDYXJkRWxlbWVudChkYXRhKSB7XG4gIGlmICghY2FyZFRlbXBsYXRlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yOiBjYXJkVGVtcGxhdGUgaXMgbm90IGRlZmluZWQgb3Igbm90IGZvdW5kLlwiKTtcbiAgICByZXR1cm4gbnVsbDsgLy8gUmV0dXJuIG51bGwgaWYgdGVtcGxhdGUgaXMgbm90IGZvdW5kXG4gIH1cblxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIikuY2xvbmVOb2RlKHRydWUpO1xuICBjb25zdCBjYXJkTmFtZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbGVtZW50ID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuICBjb25zdCBjYXJkRGVsZXRlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuXG4gIGNhcmROYW1lRWxlbWVudC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgY2FyZEltYWdlRWxlbWVudC5zcmMgPSBkYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsZW1lbnQuYWx0ID0gZGF0YS5uYW1lO1xuXG4gIGlmIChkYXRhLmlzTGlrZWQpIHtcbiAgICBjYXJkTGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fbGlrZWRcIik7XG4gIH1cblxuICBjYXJkTGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4gaGFuZGxlTGlrZShldnQsIGRhdGEuX2lkKSk7XG4gIGNhcmREZWxldGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGhhbmRsZURlbGV0ZUNhcmQoY2FyZEVsZW1lbnQsIGRhdGEuX2lkKSk7XG4gIGNhcmRJbWFnZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGhhbmRsZUltYWdlQ2xpY2soZGF0YSkpO1xuXG4gIHJldHVybiBjYXJkRWxlbWVudDsgLy8gUmV0dXJuIHRoZSBjcmVhdGVkIGNhcmQgZWxlbWVudFxufVxuXG4vLyBFdmVudCBoYW5kbGVycyBmb3IgdmFyaW91cyBhY3Rpb25zIChhdmF0YXIsIGxpa2UsIGRlbGV0ZSwgZXRjLilcbi8vIC4uLiAoc2FtZSBhcyBiZWZvcmUsIG9taXR0ZWQgZm9yIGJyZXZpdHkpXG5cbi8vIERPTSBSZWFkeVxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICBjb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG4gIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKT8uY29udGVudDsgLy8gQWNjZXNzIHRlbXBsYXRlIGhlcmVcbiAgY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcblxuICBjb25zb2xlLmxvZyhcIkNhcmQgdGVtcGxhdGU6XCIsIGNhcmRUZW1wbGF0ZSk7IC8vIExvZyB0aGUgdGVtcGxhdGVcblxuICBpZiAoIWNhcmRUZW1wbGF0ZSkge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvcjogQ2FyZCB0ZW1wbGF0ZSBub3QgZm91bmQuXCIpO1xuICAgIHJldHVybjsgLy8gU3RvcCBleGVjdXRpb24gaWYgdGVtcGxhdGUgaXMgbm90IGZvdW5kXG4gIH1cblxuICAvLyBGZXRjaCB1c2VyIGluZm8gYW5kIGNhcmRzIHdoZW4gdGhlIERPTSBpcyBsb2FkZWRcbiAgYXBpLmdldEFwcEluZm8oKS50aGVuKChbY2FyZHMsIHVzZXJzXSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwiRmV0Y2hlZCBjYXJkczpcIiwgY2FyZHMpOyAvLyBMb2cgZmV0Y2hlZCBjYXJkc1xuXG4gICAgaWYgKGNhcmRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgY29uc29sZS5sb2coXCJObyBjYXJkcyBhdmFpbGFibGVcIik7XG4gICAgICBjYXJkc0xpc3QuaW5uZXJIVE1MID0gXCI8cD5ObyBjYXJkcyB0byBkaXNwbGF5LjwvcD5cIjsgLy8gRGlzcGxheSBtZXNzYWdlIGlmIG5vIGNhcmRzXG4gICAgfSBlbHNlIHtcbiAgICAgIGNhcmRzLnJldmVyc2UoKTtcbiAgICAgIGNhcmRzLmZvckVhY2goKGNhcmQpID0+IHtcbiAgICAgICAgcmVuZGVyQ2FyZChjYXJkKTtcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFNldCB1c2VyIHByb2ZpbGUgaW5mb1xuICAgIHByb2ZpbGVJbWFnZS5zcmMgPSB1c2Vycy5hdmF0YXI7XG4gICAgcHJvZmlsZU5hbWUudGV4dENvbnRlbnQgPSB1c2Vycy5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbi50ZXh0Q29udGVudCA9IHVzZXJzLmFib3V0O1xuICB9KS5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuICAvLyBDbG9zZSBidXR0b24gZXZlbnQgbGlzdGVuZXJzXG4gIGNsb3NlQnV0dG9ucy5mb3JFYWNoKChidXR0b24pID0+IHtcbiAgICBjb25zdCBtb2RhbCA9IGJ1dHRvbi5jbG9zZXN0KFwiLm1vZGFsXCIpO1xuICAgIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChtb2RhbCkpO1xuICB9KTtcblxuICAvLyBTZXR1cCBldmVudCBsaXN0ZW5lcnMgZm9yIG1vZGFscyBhbmQgZm9ybSBzdWJtaXNzaW9uc1xuICAvLyAuLi4gKHNhbWUgYXMgYmVmb3JlLCBvbWl0dGVkIGZvciBicmV2aXR5KVxuXG4gIC8vIEVuYWJsZSBmb3JtIHZhbGlkYXRpb25cbiAgZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG59KTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBjaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIHJlcXVlc3QodXJsLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIGZldGNoKHVybCwgb3B0aW9ucykudGhlbih0aGlzLmNoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50IiwiY29uZmlnIiwic29tZSIsImlucHV0RWxlbWVudCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImNoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJyZXF1ZXN0IiwidXJsIiwib3B0aW9ucyIsImZldGNoIiwidGhlbiIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsImFkZENhcmQiLCJfcmVmMyIsImxpbmsiLCJkZWxldGVDYXJkIiwiaWQiLCJjaGFuZ2VMaWtlU3RhdHVzIiwiaXNMaWtlZCIsImF1dGhvcml6YXRpb24iLCJjbG9zZU1vZGFsT3ZlcmxheSIsImV2dCIsInRhcmdldCIsImN1cnJlbnRUYXJnZXQiLCJjbG9zZU1vZGFsIiwiY2xvc2VNb2RhbEVzYyIsImtleSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsIm1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsInJlbmRlckNhcmQiLCJpdGVtIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwidW5kZWZpbmVkIiwiY2FyZEVsZW1lbnQiLCJkYXRhIiwiY2FyZFRlbXBsYXRlIiwiY29uc29sZSIsImVycm9yIiwiY2xvbmVOb2RlIiwiY2FyZE5hbWVFbGVtZW50IiwiY2FyZEltYWdlRWxlbWVudCIsImNhcmRMaWtlQnV0dG9uIiwiY2FyZERlbGV0ZUJ1dHRvbiIsInRleHRDb250ZW50Iiwic3JjIiwiYWx0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUxpa2UiLCJfaWQiLCJoYW5kbGVEZWxldGVDYXJkIiwiaGFuZGxlSW1hZ2VDbGljayIsImdldENhcmRFbGVtZW50IiwiY2FyZHNMaXN0IiwiY2xvc2VCdXR0b25zIiwicXVlcnlTZWxlY3RvckFsbCIsImNvbnRlbnQiLCJsb2ciLCJjYXJkcyIsInVzZXJzIiwiaW5uZXJIVE1MIiwicmV2ZXJzZSIsImZvckVhY2giLCJjYXJkIiwicHJvZmlsZUltYWdlIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJjYXRjaCIsImJ1dHRvbiIsImNsb3Nlc3QiLCJmb3JtRWxlbWVudCIsInNldEV2ZW50TGlzdGVuZXJzIiwiQXJyYXkiLCJmcm9tIiwiY2hlY2tJbnB1dFZhbGlkaXR5IiwiaGlkZUlucHV0RXJyb3IiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTWVzc2FnZSIsImVycm9yRWxlbWVudCIsInZhbGlkYXRpb25NZXNzYWdlIl0sInNvdXJjZVJvb3QiOiIifQ==