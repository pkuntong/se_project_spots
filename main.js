!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_inactive",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?((e,t)=>{e.disabled=!0,e.classList.add(t.inactiveButtonClass)})(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},o=new class{constructor(e){let{baseUrl:t,headers:r}=e;this._baseUrl=t,this._headers=r}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}checkResponse(e){return e.ok?e.json():Promise.reject(`Error ${e.status}`)}request(e,t){return fetch(e,t).then(this.checkResponse)}getInitialCards(){return this.request(`${this._baseUrl}/cards`,{headers:this._headers})}getUserInfo(){return this.request(`${this._baseUrl}/users/me`,{headers:this._headers})}editUserInfo(e){let{name:t,about:r}=e;return this.request(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:t,about:r})})}editAvatarInfo(e){return this.request(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}addCard(e){let{name:t,link:r}=e;return this.request(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:r})})}deleteCard(e){return this.request(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers})}changeLikeStatus(e,t){return this.request(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers})}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"8821c207-7c9b-4450-ae25-85456081faad","Content-Type":"application/json"}});function n(e){e.target===e.currentTarget&&d(e.currentTarget)}function a(e){"Escape"===e.key&&d(document.querySelector(".modal_opened"))}function s(e){e.classList.add("modal_opened"),document.addEventListener("keydown",a),e.addEventListener("mousedown",n)}function d(e){e&&(e.classList.remove("modal_opened"),document.removeEventListener("keydown",a),e.removeEventListener("mousedown",n))}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend";const r=function(e){if(!cardTemplate)return console.error("Error: cardTemplate is not defined or not found."),null;const t=cardTemplate.querySelector(".card").cloneNode(!0),r=t.querySelector(".card__title"),o=t.querySelector(".card__image"),n=t.querySelector(".card__like-btn"),a=t.querySelector(".card__delete-btn");return r.textContent=e.name,o.src=e.link,o.alt=e.name,e.isLiked&&n.classList.add("card__like-btn_liked"),n.addEventListener("click",(t=>handleLike(t,e._id))),a.addEventListener("click",(()=>handleDeleteCard(t,e._id))),o.addEventListener("click",(()=>handleImageClick(e))),t}(e);r&&cardsList[t](r)}document.addEventListener("DOMContentLoaded",(()=>{const n=document.querySelectorAll(".modal__close-btn"),a=document.querySelector("#card-template")?.content,l=document.querySelector(".cards__list");if(console.log("Card template:",a),!a)return void console.error("Error: Card template not found.");const c=document.querySelector(".profile__avatar"),u=document.querySelector(".profile__name"),m=document.querySelector(".profile__description");o.getAppInfo().then((e=>{let[t,r]=e;console.log("Fetched cards:",t),0===t.length?(console.log("No cards available"),l.innerHTML="<p>No cards to display.</p>"):(t.reverse(),t.forEach((e=>{i(e)}))),c.src=r.avatar,u.textContent=r.name,m.textContent=r.about})).catch(console.error),n.forEach((e=>{const t=e.closest(".modal");e.addEventListener("click",(()=>d(t)))}));const h=document.querySelector(".profile__avatar-btn"),_=document.querySelector("#avatar-modal"),v=_.querySelector("#edit-avatar-form");h.addEventListener("click",(()=>s(_))),v.addEventListener("submit",handleAvatarSubmit);const p=document.querySelector(".profile__edit-btn"),f=document.querySelector("#edit-modal"),y=f.querySelector("#edit-profile-form"),S=f.querySelector("#profile-name-input"),b=f.querySelector("#profile-description-input");p.addEventListener("click",(()=>{var r,o;S.value=u.textContent,b.value=m.textContent,r=y,o=e,[S,b].forEach((e=>{t(r,e,o)})),s(f)})),y.addEventListener("submit",handleEditProfileSubmit);const q=document.querySelector(".profile__add-btn"),E=document.querySelector("#card-modal"),L=E.querySelector("#card-form");q.addEventListener("click",(()=>s(E))),L.addEventListener("submit",handleAddCardSubmit);const C=document.querySelector("#delete-modal"),k=C.querySelector(".modal__form"),g=C.querySelector(".modal__submit-btn_type_cancel");var U;k.addEventListener("submit",handleDeleteCardSubmit),g.addEventListener("click",(()=>d(C))),U=e,document.querySelectorAll(U.formSelector).forEach((e=>{((e,o)=>{const n=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);console.log(n),console.log(a),r(n,a,o),n.forEach((s=>{s.addEventListener("input",(function(){((e,r,o)=>{r.validity.valid?t(e,r,o):((e,t,r,o)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=r})(e,r,r.validationMessage,o)})(e,s,o),r(n,a,o)}))}))})(e,U)}))}))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUl2RixHQUVaRixFQUFrQkMsRUFBV0MsRUFBZVIsR0FFNUNPLEVBQVVnRyxTQUFTeEcsSUFDakJBLEVBQWFvRSxpQkFBaUIsU0FBUyxXQW5EaEJpRSxFQUFDdEksRUFBYUMsRUFBY0MsS0FDaERELEVBQWFXLFNBQVNDLE1BUXpCZCxFQUFlQyxFQUFhQyxFQUFjQyxHQXJCdkJxSSxFQUFDdkksRUFBYUMsRUFBY3VJLEVBQWN0SSxLQUMvRCxNQUFNdUksRUFBZXpJLEVBQVlHLGNBQWMsSUFBSUYsRUFBYUcsWUFDaEVILEVBQWFLLFVBQVVXLElBQUlmLEVBQU9MLGlCQUNsQzRJLEVBQWFwSSxZQUFjbUksQ0FBWSxFQVdyQ0QsQ0FDRXZJLEVBQ0FDLEVBQ0FBLEVBQWF5SSxrQkFDYnhJLEVBSUosRUEwQ0lvSSxDQUFtQnRJLEVBQWFDLEVBQWNDLEdBQzlDTSxFQUFrQkMsRUFBV0MsRUFBZVIsRUFDOUMsR0FBRSxHQUNGLEVBTUFpSSxDQUFrQm5JLEVBQWFFLEVBQU8sR0M2RmhCLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3BhZ2VzL2luZGV4LmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvdXRpbHMvQXBpLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjb25zdCBzZXR0aW5ncyA9IHtcbiAgICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gICAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXG4gICAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9pbmFjdGl2ZVwiLFxuICAgIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICAgIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yXCIsXG4gIH07XG4gIFxuICBjb25zdCBzaG93SW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBlcnJvck1lc3NhZ2UsIGNvbmZpZykgPT4ge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWxlbWVudC5pZH0tZXJyb3JgKTtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBlcnJvck1lc3NhZ2U7XG4gIH07XG4gIFxuICBjb25zdCBoaWRlSW5wdXRFcnJvciA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsZW1lbnQuaWR9LWVycm9yYCk7XG4gICAgZXJyb3JFbGVtZW50LnRleHRDb250ZW50ID0gXCJcIjtcbiAgICBpbnB1dEVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgfTtcbiAgXG4gIGNvbnN0IGNoZWNrSW5wdXRWYWxpZGl0eSA9IChmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBpZiAoIWlucHV0RWxlbWVudC52YWxpZGl0eS52YWxpZCkge1xuICAgICAgc2hvd0lucHV0RXJyb3IoXG4gICAgICAgIGZvcm1FbGVtZW50LFxuICAgICAgICBpbnB1dEVsZW1lbnQsXG4gICAgICAgIGlucHV0RWxlbWVudC52YWxpZGF0aW9uTWVzc2FnZSxcbiAgICAgICAgY29uZmlnXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWxlbWVudCwgaW5wdXRFbGVtZW50LCBjb25maWcpO1xuICAgIH1cbiAgfTtcbiAgXG4gIGNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWxlbWVudCkgPT4ge1xuICAgICAgcmV0dXJuICFpbnB1dEVsZW1lbnQudmFsaWRpdHkudmFsaWQ7XG4gICAgfSk7XG4gIH07XG4gIFxuICBleHBvcnQgY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBidXR0b25FbGVtZW50LmRpc2FibGVkID0gdHJ1ZTtcbiAgICBidXR0b25FbGVtZW50LmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9O1xuICBcbiAgY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpID0+IHtcbiAgICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICAgIGRpc2FibGVCdXR0b24oYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYnV0dG9uRWxlbWVudC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgYnV0dG9uRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICB9XG4gIH07XG4gIFxuICBleHBvcnQgY29uc3QgcmVzZXRWYWxpZGF0aW9uID0gKGZvcm1FbGVtZW50LCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuICAgIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dCkgPT4ge1xuICAgICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsZW1lbnQsIGlucHV0LCBjb25maWcpO1xuICAgIH0pO1xuICB9O1xuICBcbiAgY29uc3Qgc2V0RXZlbnRMaXN0ZW5lcnMgPSAoZm9ybUVsZW1lbnQsIGNvbmZpZykgPT4ge1xuICAgIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oXG4gICAgICBmb3JtRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKVxuICAgICk7XG4gICAgY29uc3QgYnV0dG9uRWxlbWVudCA9IGZvcm1FbGVtZW50LnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgXG4gICAgY29uc29sZS5sb2coaW5wdXRMaXN0KTtcbiAgICBjb25zb2xlLmxvZyhidXR0b25FbGVtZW50KTtcbiAgXG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbGVtZW50LCBjb25maWcpO1xuICBcbiAgICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbGVtZW50KSA9PiB7XG4gICAgICBpbnB1dEVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbGVtZW50LCBpbnB1dEVsZW1lbnQsIGNvbmZpZyk7XG4gICAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWxlbWVudCwgY29uZmlnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9O1xuICBcbiAgZXhwb3J0IGNvbnN0IGVuYWJsZVZhbGlkYXRpb24gPSAoY29uZmlnKSA9PiB7XG4gICAgY29uc3QgZm9ybUxpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5mb3JtU2VsZWN0b3IpO1xuICAgIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbGVtZW50KSA9PiB7XG4gICAgICBzZXRFdmVudExpc3RlbmVycyhmb3JtRWxlbWVudCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfTtcbiAgIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHNldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCB7IGhhbmRsZVN1Ym1pdCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi91dGlscy9BcGkuanNcIjtcblxubGV0IHNlbGVjdGVkQ2FyZCwgc2VsZWN0ZWRDYXJkSWQ7XG5cbi8vIEFQSSBzZXR1cFxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiODgyMWMyMDctN2M5Yi00NDUwLWFlMjUtODU0NTYwODFmYWFkXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH0sXG59KTtcblxuLy8gRnVuY3Rpb25zIHRvIGhhbmRsZSBtb2RhbHNcbmZ1bmN0aW9uIGNsb3NlTW9kYWxPdmVybGF5KGV2dCkge1xuICBpZiAoZXZ0LnRhcmdldCA9PT0gZXZ0LmN1cnJlbnRUYXJnZXQpIHtcbiAgICBjbG9zZU1vZGFsKGV2dC5jdXJyZW50VGFyZ2V0KTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjbG9zZU1vZGFsRXNjKGV2dCkge1xuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xuICAgIGNvbnN0IG1vZGFsT3BlbmVkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9vcGVuZWRcIik7XG4gICAgY2xvc2VNb2RhbChtb2RhbE9wZW5lZCk7XG4gIH1cbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFc2MpO1xuICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIGNsb3NlTW9kYWxPdmVybGF5KTtcbn1cblxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBpZiAobW9kYWwpIHtcbiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGNsb3NlTW9kYWxFc2MpO1xuICAgIG1vZGFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgY2xvc2VNb2RhbE92ZXJsYXkpO1xuICB9XG59XG5cbi8vIEZ1bmN0aW9uIHRvIHJlbmRlciBhIGNhcmRcbmZ1bmN0aW9uIHJlbmRlckNhcmQoaXRlbSwgbWV0aG9kID0gXCJwcmVwZW5kXCIpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgaWYgKGNhcmRFbGVtZW50KSB7XG4gICAgY2FyZHNMaXN0W21ldGhvZF0oY2FyZEVsZW1lbnQpOyAvLyBBcHBlbmQgdGhlIGNhcmQgdG8gdGhlIGNhcmRzIGxpc3RcbiAgfVxufVxuXG4vLyBDcmVhdGUgYSBjYXJkIGVsZW1lbnQgZnJvbSB0aGUgdGVtcGxhdGVcbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgaWYgKCFjYXJkVGVtcGxhdGUpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3I6IGNhcmRUZW1wbGF0ZSBpcyBub3QgZGVmaW5lZCBvciBub3QgZm91bmQuXCIpO1xuICAgIHJldHVybiBudWxsOyAvLyBSZXR1cm4gbnVsbCBpZiB0ZW1wbGF0ZSBpcyBub3QgZm91bmRcbiAgfVxuXG4gIGNvbnN0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKS5jbG9uZU5vZGUodHJ1ZSk7XG4gIGNvbnN0IGNhcmROYW1lRWxlbWVudCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGNhcmRJbWFnZUVsZW1lbnQgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCBjYXJkTGlrZUJ1dHRvbiA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idG5cIik7XG5cbiAgY2FyZE5hbWVFbGVtZW50LnRleHRDb250ZW50ID0gZGF0YS5uYW1lO1xuICBjYXJkSW1hZ2VFbGVtZW50LnNyYyA9IGRhdGEubGluaztcbiAgY2FyZEltYWdlRWxlbWVudC5hbHQgPSBkYXRhLm5hbWU7XG5cbiAgaWYgKGRhdGEuaXNMaWtlZCkge1xuICAgIGNhcmRMaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJjYXJkX19saWtlLWJ0bl9saWtlZFwiKTtcbiAgfVxuXG4gIGNhcmRMaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiBoYW5kbGVMaWtlKGV2dCwgZGF0YS5faWQpKTtcbiAgY2FyZERlbGV0ZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlRGVsZXRlQ2FyZChjYXJkRWxlbWVudCwgZGF0YS5faWQpKTtcbiAgY2FyZEltYWdlRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gaGFuZGxlSW1hZ2VDbGljayhkYXRhKSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50OyAvLyBSZXR1cm4gdGhlIGNyZWF0ZWQgY2FyZCBlbGVtZW50XG59XG5cbi8vIEV2ZW50IGhhbmRsZXJzIGZvciB2YXJpb3VzIGFjdGlvbnMgKGF2YXRhciwgbGlrZSwgZGVsZXRlLCBldGMuKVxuLy8gQXNzdW1pbmcgeW91IGhhdmUgdGhlc2UgZnVuY3Rpb25zIGRlZmluZWRcbi8vIGZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdCgpIHsgLi4uIH1cbi8vIGZ1bmN0aW9uIGhhbmRsZUxpa2UoKSB7IC4uLiB9XG4vLyBmdW5jdGlvbiBoYW5kbGVEZWxldGVDYXJkKCkgeyAuLi4gfVxuLy8gZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljaygpIHsgLi4uIH1cbi8vIGZ1bmN0aW9uIGhhbmRsZUVkaXRQcm9maWxlU3VibWl0KCkgeyAuLi4gfVxuLy8gZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdCgpIHsgLi4uIH1cbi8vIGZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNhcmRTdWJtaXQoKSB7IC4uLiB9XG5cbi8vIERPTSBSZWFkeVxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgKCkgPT4ge1xuICBjb25zdCBjbG9zZUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG4gIGNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKT8uY29udGVudDsgLy8gQWNjZXNzIHRlbXBsYXRlIGhlcmVcbiAgY29uc3QgY2FyZHNMaXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkc19fbGlzdFwiKTtcbiAgXG4gIC8vIExvZyB0aGUgY2FyZCB0ZW1wbGF0ZSB0byBjaGVjayBpZiBpdCdzIGZvdW5kXG4gIGNvbnNvbGUubG9nKFwiQ2FyZCB0ZW1wbGF0ZTpcIiwgY2FyZFRlbXBsYXRlKTsgXG5cbiAgLy8gRW5zdXJlIHRoZSBjYXJkVGVtcGxhdGUgZXhpc3RzIGJlZm9yZSBwcm9jZWVkaW5nXG4gIGlmICghY2FyZFRlbXBsYXRlKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yOiBDYXJkIHRlbXBsYXRlIG5vdCBmb3VuZC5cIik7XG4gICAgcmV0dXJuOyAvLyBTdG9wIGV4ZWN1dGlvbiBpZiB0ZW1wbGF0ZSBpcyBub3QgZm91bmRcbiAgfVxuXG4gIC8vIFByb2ZpbGUgZWxlbWVudHNcbiAgY29uc3QgcHJvZmlsZUltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG4gIGNvbnN0IHByb2ZpbGVOYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuICBjb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG4gIC8vIEZldGNoIHVzZXIgaW5mbyBhbmQgY2FyZHMgd2hlbiB0aGUgRE9NIGlzIGxvYWRlZFxuICBhcGkuZ2V0QXBwSW5mbygpLnRoZW4oKFtjYXJkcywgdXNlcnNdKSA9PiB7XG4gICAgY29uc29sZS5sb2coXCJGZXRjaGVkIGNhcmRzOlwiLCBjYXJkcyk7IC8vIExvZyBmZXRjaGVkIGNhcmRzXG5cbiAgICBpZiAoY2FyZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIk5vIGNhcmRzIGF2YWlsYWJsZVwiKTtcbiAgICAgIGNhcmRzTGlzdC5pbm5lckhUTUwgPSBcIjxwPk5vIGNhcmRzIHRvIGRpc3BsYXkuPC9wPlwiOyAvLyBEaXNwbGF5IG1lc3NhZ2UgaWYgbm8gY2FyZHNcbiAgICB9IGVsc2Uge1xuICAgICAgY2FyZHMucmV2ZXJzZSgpO1xuICAgICAgY2FyZHMuZm9yRWFjaCgoY2FyZCkgPT4ge1xuICAgICAgICByZW5kZXJDYXJkKGNhcmQpOyAvLyBSZW5kZXIgZWFjaCBjYXJkXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTZXQgdXNlciBwcm9maWxlIGluZm9cbiAgICBwcm9maWxlSW1hZ2Uuc3JjID0gdXNlcnMuYXZhdGFyO1xuICAgIHByb2ZpbGVOYW1lLnRleHRDb250ZW50ID0gdXNlcnMubmFtZTtcbiAgICBwcm9maWxlRGVzY3JpcHRpb24udGV4dENvbnRlbnQgPSB1c2Vycy5hYm91dDtcbiAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7XG5cbiAgLy8gQ2xvc2UgYnV0dG9uIGV2ZW50IGxpc3RlbmVyc1xuICBjbG9zZUJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XG4gICAgY29uc3QgbW9kYWwgPSBidXR0b24uY2xvc2VzdChcIi5tb2RhbFwiKTtcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobW9kYWwpKTtcbiAgfSk7XG5cbiAgLy8gU2V0dXAgZXZlbnQgbGlzdGVuZXJzIGZvciBtb2RhbHMgYW5kIGZvcm0gc3VibWlzc2lvbnNcbiAgLy8gQXNzdW1pbmcgdGhlc2UgZWxlbWVudHMgYXJlIGNvcnJlY3RseSBkZWZpbmVkIGluIHlvdXIgSFRNTFxuICBjb25zdCBhdmF0YXJNb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyLWJ0blwiKTtcbiAgY29uc3QgYXZhdGFyTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1tb2RhbFwiKTtcbiAgY29uc3QgYXZhdGFyTW9kYWxGb3JtID0gYXZhdGFyTW9kYWwucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1mb3JtXCIpO1xuICBhdmF0YXJNb2RhbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gb3Blbk1vZGFsKGF2YXRhck1vZGFsKSk7XG4gIGF2YXRhck1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbiAgY29uc3QgZWRpdFByb2ZpbGVCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnRuXCIpO1xuICBjb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LW1vZGFsXCIpO1xuICBjb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1wcm9maWxlLWZvcm1cIik7XG4gIGNvbnN0IG5hbWVJbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLW5hbWUtaW5wdXRcIik7XG4gIGNvbnN0IGRlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiKTtcbiAgZWRpdFByb2ZpbGVCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBuYW1lSW5wdXQudmFsdWUgPSBwcm9maWxlTmFtZS50ZXh0Q29udGVudDtcbiAgICBkZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uLnRleHRDb250ZW50O1xuICAgIHJlc2V0VmFsaWRhdGlvbihlZGl0UHJvZmlsZUZvcm0sIFtuYW1lSW5wdXQsIGRlc2NyaXB0aW9uSW5wdXRdLCBzZXR0aW5ncyk7XG4gICAgb3Blbk1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xuICB9KTtcbiAgZWRpdFByb2ZpbGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRWRpdFByb2ZpbGVTdWJtaXQpO1xuXG4gIGNvbnN0IGNhcmRNb2RhbEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYWRkLWJ0blwiKTtcbiAgY29uc3QgY2FyZE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLW1vZGFsXCIpO1xuICBjb25zdCBjYXJkTW9kYWxGb3JtID0gY2FyZE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1mb3JtXCIpO1xuICBjYXJkTW9kYWxCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG9wZW5Nb2RhbChjYXJkTW9kYWwpKTtcbiAgY2FyZE1vZGFsRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUFkZENhcmRTdWJtaXQpO1xuXG4gIGNvbnN0IGRlbGV0ZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZWxldGUtbW9kYWxcIik7XG4gIGNvbnN0IGRlbGV0ZUZvcm0gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuICBjb25zdCBkZWxldGVDYW5jZWxCdXR0b24gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuX3R5cGVfY2FuY2VsXCIpO1xuICBkZWxldGVGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlRGVsZXRlQ2FyZFN1Ym1pdCk7XG4gIGRlbGV0ZUNhbmNlbEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChkZWxldGVNb2RhbCkpO1xuXG4gIC8vIEVuYWJsZSBmb3JtIHZhbGlkYXRpb25cbiAgZW5hYmxlVmFsaWRhdGlvbihzZXR0aW5ncyk7XG59KTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmw7XG4gICAgdGhpcy5faGVhZGVycyA9IGhlYWRlcnM7XG4gIH1cblxuICBnZXRBcHBJbmZvKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRJbml0aWFsQ2FyZHMoKSwgdGhpcy5nZXRVc2VySW5mbygpXSk7XG4gIH1cblxuICBjaGVja1Jlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHtcbiAgICAgIHJldHVybiByZXMuanNvbigpO1xuICAgIH1cbiAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoYEVycm9yICR7cmVzLnN0YXR1c31gKTtcbiAgfVxuXG4gIHJlcXVlc3QodXJsLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIGZldGNoKHVybCwgb3B0aW9ucykudGhlbih0aGlzLmNoZWNrUmVzcG9uc2UpO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMucmVxdWVzdChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbmFtZSxcbiAgICAgICAgYWJvdXQsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGVkaXRBdmF0YXJJbmZvKGF2YXRhcikge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBhdmF0YXIsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIGxpbmssXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIGRlbGV0ZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VTdGF0dXMoaWQsIGlzTGlrZWQpIHtcbiAgICByZXR1cm4gdGhpcy5yZXF1ZXN0KGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzLyR7aWR9L2xpa2VzYCwge1xuICAgICAgbWV0aG9kOiBpc0xpa2VkID8gXCJERUxFVEVcIiA6IFwiUFVUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgIH0pO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaTtcbiJdLCJuYW1lcyI6WyJzZXR0aW5ncyIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiaGlkZUlucHV0RXJyb3IiLCJmb3JtRWxlbWVudCIsImlucHV0RWxlbWVudCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbGVtZW50Iiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJhZGQiLCJhcGkiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0QXBwSW5mbyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImNoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJyZXF1ZXN0IiwidXJsIiwib3B0aW9ucyIsImZldGNoIiwidGhlbiIsImVkaXRVc2VySW5mbyIsIl9yZWYyIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJlZGl0QXZhdGFySW5mbyIsImF2YXRhciIsImFkZENhcmQiLCJfcmVmMyIsImxpbmsiLCJkZWxldGVDYXJkIiwiY2hhbmdlTGlrZVN0YXR1cyIsImlzTGlrZWQiLCJhdXRob3JpemF0aW9uIiwiY2xvc2VNb2RhbE92ZXJsYXkiLCJldnQiLCJ0YXJnZXQiLCJjdXJyZW50VGFyZ2V0IiwiY2xvc2VNb2RhbCIsImNsb3NlTW9kYWxFc2MiLCJrZXkiLCJkb2N1bWVudCIsIm9wZW5Nb2RhbCIsIm1vZGFsIiwiYWRkRXZlbnRMaXN0ZW5lciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW5kZXJDYXJkIiwiaXRlbSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInVuZGVmaW5lZCIsImNhcmRFbGVtZW50IiwiZGF0YSIsImNhcmRUZW1wbGF0ZSIsImNvbnNvbGUiLCJlcnJvciIsImNsb25lTm9kZSIsImNhcmROYW1lRWxlbWVudCIsImNhcmRJbWFnZUVsZW1lbnQiLCJjYXJkTGlrZUJ1dHRvbiIsImNhcmREZWxldGVCdXR0b24iLCJzcmMiLCJhbHQiLCJoYW5kbGVMaWtlIiwiX2lkIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImhhbmRsZUltYWdlQ2xpY2siLCJnZXRDYXJkRWxlbWVudCIsImNhcmRzTGlzdCIsImNsb3NlQnV0dG9ucyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjb250ZW50IiwibG9nIiwicHJvZmlsZUltYWdlIiwicHJvZmlsZU5hbWUiLCJwcm9maWxlRGVzY3JpcHRpb24iLCJjYXJkcyIsInVzZXJzIiwiaW5uZXJIVE1MIiwicmV2ZXJzZSIsImZvckVhY2giLCJjYXJkIiwiY2F0Y2giLCJidXR0b24iLCJjbG9zZXN0IiwiYXZhdGFyTW9kYWxCdXR0b24iLCJhdmF0YXJNb2RhbCIsImF2YXRhck1vZGFsRm9ybSIsImhhbmRsZUF2YXRhclN1Ym1pdCIsImVkaXRQcm9maWxlQnV0dG9uIiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlRm9ybSIsIm5hbWVJbnB1dCIsImRlc2NyaXB0aW9uSW5wdXQiLCJyZXNldFZhbGlkYXRpb24iLCJ2YWx1ZSIsImlucHV0IiwiaGFuZGxlRWRpdFByb2ZpbGVTdWJtaXQiLCJjYXJkTW9kYWxCdXR0b24iLCJjYXJkTW9kYWwiLCJjYXJkTW9kYWxGb3JtIiwiaGFuZGxlQWRkQ2FyZFN1Ym1pdCIsImRlbGV0ZU1vZGFsIiwiZGVsZXRlRm9ybSIsImRlbGV0ZUNhbmNlbEJ1dHRvbiIsImhhbmRsZURlbGV0ZUNhcmRTdWJtaXQiLCJzZXRFdmVudExpc3RlbmVycyIsIkFycmF5IiwiZnJvbSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNob3dJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwidmFsaWRhdGlvbk1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9